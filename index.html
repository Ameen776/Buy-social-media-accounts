<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سوق الحسابات | منصة بيع وشراء الحسابات</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background: #0f172a;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* شاشة التسجيل */
        .auth-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        .auth-container {
            background: rgba(15, 23, 42, 0.95);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h1 {
            font-size: 32px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .auth-header p {
            color: #94a3b8;
            font-size: 14px;
        }

        .brand-icons {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 20px 0 30px;
            flex-wrap: wrap;
        }

        .brand-icon {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-weight: 600;
            font-size: 15px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 14px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #475569;
            border-radius: 10px;
            color: white;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .auth-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .loading-section {
            text-align: center;
            padding: 30px 0;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(59, 130, 246, 0.2);
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-check {
            width: 70px;
            height: 70px;
            margin: 0 auto 20px;
            color: #10b981;
            font-size: 70px;
            animation: checkmark 0.5s ease-in-out;
        }

        @keyframes checkmark {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        .hidden {
            display: none !important;
        }

        /* التطبيق الرئيسي */
        #app {
            min-height: 100vh;
            display: none;
        }

        /* شريط التنقل */
        .navbar {
            background: rgba(15, 23, 42, 0.95);
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 28px;
            color: #3b82f6;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-btn {
            padding: 10px 20px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border-radius: 10px;
            color: white;
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 14px;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .nav-btn.red {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .nav-btn.green {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* المحتوى الرئيسي */
        .main-content {
            padding: 30px 5%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .section-title {
            font-size: 28px;
            margin-bottom: 25px;
            color: white;
            text-align: center;
        }

        /* بطاقات الحسابات */
        .accounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .account-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid #475569;
            transition: all 0.3s;
        }

        .account-card:hover {
            transform: translateY(-5px);
            border-color: #3b82f6;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(15, 23, 42, 0.8);
            border-bottom: 1px solid #475569;
        }

        .platform-badge {
            width: 55px;
            height: 55px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            color: white;
        }

        .platform-badge.instagram {
            background: linear-gradient(45deg, #833AB4, #E1306C, #FCAF45);
        }
        .platform-badge.facebook {
            background: #1877F2;
        }
        .platform-badge.tiktok {
            background: #000;
        }
        .platform-badge.twitter {
            background: #1DA1F2;
        }
        .platform-badge.youtube {
            background: #FF0000;
        }
        .platform-badge.snapchat {
            background: #FFFC00;
            color: #000;
        }

        .card-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .card-info p {
            color: #94a3b8;
            font-size: 14px;
        }

        .card-details {
            padding: 20px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detail-label {
            color: #94a3b8;
            font-size: 14px;
        }

        .detail-value {
            font-weight: 600;
            font-size: 14px;
        }

        .card-price {
            text-align: center;
            font-size: 28px;
            font-weight: 800;
            color: #10b981;
            padding: 20px;
            background: rgba(16, 185, 129, 0.1);
            border-top: 1px solid #475569;
        }

        .card-images {
            padding: 15px;
            border-top: 1px solid #475569;
        }

        .images-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            color: #cbd5e1;
            font-weight: 600;
            font-size: 15px;
        }

        .images-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .image-thumb {
            height: 90px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            background: #1e293b;
        }

        .image-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-actions {
            padding: 15px 20px 20px;
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 14px;
        }

        .action-btn.primary {
            background: #3b82f6;
            color: white;
        }

        .action-btn.primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .action-btn.secondary {
            background: #475569;
            color: white;
        }

        .action-btn.secondary:hover {
            background: #64748b;
            transform: translateY(-2px);
        }

        .seller-info {
            padding: 15px 20px;
            border-top: 1px solid #475569;
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(15, 23, 42, 0.5);
        }

        .seller-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        /* نافذة الإضافة */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal {
            background: rgba(15, 23, 42, 0.95);
            border-radius: 15px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 25px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 22px;
            color: white;
        }

        .modal-close {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 22px;
            cursor: pointer;
        }

        .upload-area {
            border: 2px dashed #475569;
            border-radius: 10px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        .upload-icon {
            font-size: 40px;
            color: #3b82f6;
            margin-bottom: 10px;
        }

        .upload-info {
            color: #94a3b8;
            font-size: 14px;
            margin-top: 5px;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .preview-item {
            position: relative;
            height: 90px;
            border-radius: 8px;
            overflow: hidden;
            background: #1e293b;
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }

        /* نافذة الدردشة */
        .chat-window {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 380px;
            height: 500px;
            background: rgba(15, 23, 42, 0.95);
            border-radius: 15px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            display: none;
            flex-direction: column;
            z-index: 2000;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
        }

        .chat-header {
            padding: 15px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-badge {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 15px;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message-bubble {
            max-width: 85%;
            padding: 12px 15px;
            border-radius: 15px;
            position: relative;
            font-size: 14px;
        }

        .message-bubble.sent {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            align-self: flex-end;
        }

        .message-bubble.received {
            background: #475569;
            align-self: flex-start;
        }

        .chat-input-area {
            padding: 15px;
            border-top: 1px solid #475569;
            display: flex;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            padding: 12px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #475569;
            border-radius: 10px;
            color: white;
            font-size: 14px;
        }

        .send-btn {
            width: 45px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* صفحة المستخدمين */
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .user-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid #475569;
            transition: all 0.3s;
            cursor: pointer;
        }

        .user-card:hover {
            border-color: #3b82f6;
            transform: translateY(-3px);
        }

        .user-avatar-large {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: 700;
        }

        .user-details h3 {
            font-size: 17px;
            margin-bottom: 5px;
        }

        .user-details p {
            color: #94a3b8;
            font-size: 13px;
        }

        /* تنبيهات */
        .alert-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
        }

        .alert {
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            animation: slideIn 0.3s ease-out;
            font-size: 14px;
        }

        .alert.success {
            border-color: #10b981;
            color: #10b981;
        }

        .alert.error {
            border-color: #ef4444;
            color: #ef4444;
        }

        .alert.info {
            border-color: #3b82f6;
            color: #3b82f6;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .accounts-grid {
                grid-template-columns: 1fr;
            }
            
            .chat-window {
                width: 100%;
                height: 70vh;
                bottom: 0;
                left: 0;
                border-radius: 15px 15px 0 0;
            }
            
            .nav-controls {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }
            
            .modal {
                padding: 20px;
            }
            
            .auth-container {
                padding: 30px 20px;
            }
        }

        /* أدوات مساعدة */
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .status-sold {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .empty-state i {
            font-size: 50px;
            margin-bottom: 20px;
            color: #475569;
        }
    </style>
</head>
<body>
    <!-- شاشة التسجيل -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <div class="auth-header">
                <h1>سوق الحسابات</h1>
                <p>منصة بيع وشراء حسابات التواصل الاجتماعي</p>
            </div>
            
            <div class="brand-icons">
                <div class="brand-icon" style="background: linear-gradient(45deg, #833AB4, #E1306C);">
                    <i class="fab fa-instagram"></i>
                </div>
                <div class="brand-icon" style="background: #1877F2;">
                    <i class="fab fa-facebook"></i>
                </div>
                <div class="brand-icon" style="background: #000;">
                    <i class="fab fa-tiktok"></i>
                </div>
                <div class="brand-icon" style="background: #1DA1F2;">
                    <i class="fab fa-twitter"></i>
                </div>
                <div class="brand-icon" style="background: #FF0000;">
                    <i class="fab fa-youtube"></i>
                </div>
            </div>
            
            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-user"></i> الاسم الكامل</label>
                    <input type="text" class="form-input" id="userName" placeholder="أحمد محمد" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-phone"></i> رقم الهاتف</label>
                    <input type="tel" class="form-input" id="userPhone" placeholder="05XXXXXXXX" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-globe"></i> الدولة</label>
                    <select class="form-select" id="userCountry" required>
                        <option value="">اختر الدولة</option>
                        <option value="السعودية">السعودية</option>
                        <option value="الإمارات">الإمارات</option>
                        <option value="الكويت">الكويت</option>
                        <option value="قطر">قطر</option>
                        <option value="عُمان">عُمان</option>
                        <option value="البحرين">البحرين</option>
                        <option value="مصر">مصر</option>
                        <option value="الأردن">الأردن</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-home"></i> العنوان</label>
                    <textarea class="form-textarea" id="userAddress" placeholder="اكتب عنوانك بالتفصيل"></textarea>
                </div>
                
                <button type="submit" class="auth-btn">
                    <i class="fas fa-user-plus"></i> إنشاء حساب جديد
                </button>
            </form>
            
            <!-- شاشة التحميل -->
            <div id="loadingSection" class="hidden">
                <div class="loading-section">
                    <div class="loading-spinner"></div>
                    <div style="text-align: center; color: #94a3b8; margin-top: 15px;">جاري إنشاء حسابك...</div>
                </div>
            </div>
            
            <!-- شاشة النجاح -->
            <div id="successSection" class="hidden">
                <div class="loading-section">
                    <div class="success-check">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div style="text-align: center; color: #10b981; margin-top: 15px; font-weight: 600;">تم إنشاء حسابك بنجاح!</div>
                </div>
            </div>
        </div>
    </div>

    <!-- التطبيق الرئيسي -->
    <div id="app">
        <!-- شريط التنقل -->
        <nav class="navbar">
            <div class="logo-container">
                <i class="logo-icon fas fa-store"></i>
                <div class="logo-text">سوق الحسابات</div>
            </div>
            
            <div class="nav-controls">
                <a href="#" class="nav-btn" id="addAccountBtn">
                    <i class="fas fa-plus"></i> إضافة حساب
                </a>
                
                <a href="#" class="nav-btn red" id="viewUsersBtn">
                    <i class="fas fa-users"></i> المستخدمين
                </a>
                
                <a href="#" class="nav-btn green" id="viewChatsBtn">
                    <i class="fas fa-comments"></i> الدردشات
                </a>
                
                <div class="user-profile">
                    <div class="user-avatar" id="userAvatar">أ</div>
                    <div>
                        <div id="userDisplayName">أحمد محمد</div>
                        <div id="userDisplayPhone" style="font-size: 12px; color: #94a3b8;">05XXXXXXXX</div>
                    </div>
                </div>
                
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </nav>

        <!-- المحتوى الرئيسي -->
        <div class="main-content">
            <h1 class="section-title" id="pageTitle">الحسابات المتاحة للشراء</h1>
            
            <div id="accountsList" class="accounts-grid">
                <!-- الحسابات تظهر هنا -->
            </div>
            
            <div id="usersList" class="users-grid hidden">
                <!-- المستخدمين يظهرون هنا -->
            </div>
        </div>

        <!-- نافذة إضافة حساب -->
        <div class="modal-overlay" id="addModal">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-plus-circle"></i> إضافة حساب للبيع</div>
                    <button class="modal-close" id="closeAddModal">×</button>
                </div>
                
                <form id="addAccountForm">
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-globe"></i> منصة التواصل</label>
                        <select class="form-select" id="accountPlatform" required>
                            <option value="">اختر المنصة</option>
                            <option value="instagram">إنستغرام</option>
                            <option value="facebook">فيسبوك</option>
                            <option value="tiktok">تيك توك</option>
                            <option value="twitter">تويتر</option>
                            <option value="youtube">يوتيوب</option>
                            <option value="snapchat">سناب شات</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-at"></i> اسم المستخدم</label>
                        <input type="text" class="form-input" id="accountUsername" placeholder="@username" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-users"></i> عدد المتابعين</label>
                        <input type="number" class="form-input" id="accountFollowers" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-tag"></i> السعر (ريال سعودي)</label>
                        <input type="number" class="form-input" id="accountPrice" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-file-alt"></i> وصف الحساب</label>
                        <textarea class="form-textarea" id="accountDescription" rows="3" placeholder="صف الحساب..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-images"></i> صور إثبات الملكية (2-3 صور)</label>
                        <div class="upload-area" id="imageUploadArea">
                            <i class="upload-icon fas fa-cloud-upload-alt"></i>
                            <div style="font-size: 16px; color: white;">انقر لرفع صور إثبات ملكية الحساب</div>
                            <div class="upload-info">يمكنك رفع حتى 3 صور (الحجم المسموح: 5MB لكل صورة)</div>
                            <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                        </div>
                        
                        <div class="preview-grid" id="imagesPreview">
                            <!-- معاينة الصور تظهر هنا -->
                        </div>
                    </div>
                    
                    <button type="submit" class="auth-btn">
                        <i class="fas fa-upload"></i> نشر الحساب للبيع
                    </button>
                </form>
            </div>
        </div>

        <!-- نافذة الدردشة -->
        <div class="chat-window" id="chatModal">
            <div class="chat-header">
                <div class="chat-user">
                    <div class="user-badge" id="chatAvatar">س</div>
                    <div>
                        <div id="chatUserName">سالم أحمد</div>
                        <div id="chatUserStatus" style="font-size: 12px; color: #94a3b8;">متصل الآن</div>
                    </div>
                </div>
                <button class="modal-close" id="closeChat">×</button>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <!-- الرسائل تظهر هنا -->
            </div>
            
            <div class="chat-input-area">
                <input type="text" class="message-input" id="chatInput" placeholder="اكتب رسالتك هنا...">
                <button class="send-btn" id="sendMessageBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- تنبيهات -->
    <div class="alert-container" id="alertContainer"></div>

    <script>
        // تهيئة Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB8lL0EtnVYNtUqE7C2gzqiwFHK23TTM7w",
            authDomain: "hakr-1xbet.firebaseapp.com",
            projectId: "hakr-1xbet",
            storageBucket: "hakr-1xbet.firebasestorage.app",
            messagingSenderId: "516332204234",
            appId: "1:516332204234:web:e7a87ff173c5086c184433",
            measurementId: "G-Y8Y9GKS43H"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // حالات التطبيق
        let currentUser = null;
        let currentChatUser = null;
        let chatListener = null;
        let uploadedImages = [];
        const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB
        const ALLOWED_TYPES = ['image/jpeg', 'image/png', 'image/jpg', 'image/gif'];

        // 1. عرض التنبيه
        function showAlert(message, type = 'error') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type}`;
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 
                                     type === 'success' ? 'check-circle' : 
                                     'info-circle'}"></i>
                ${message}
            `;
            
            document.getElementById('alertContainer').appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.style.opacity = '0';
                setTimeout(() => {
                    alertDiv.remove();
                }, 300);
            }, 5000);
        }

        // 2. تسجيل حساب جديد
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('userName').value.trim();
            const phone = document.getElementById('userPhone').value.trim();
            const country = document.getElementById('userCountry').value;
            const address = document.getElementById('userAddress').value.trim();
            
            // تحقق من البيانات
            if (!name || !phone || !country) {
                showAlert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }
            
            if (phone.length < 10) {
                showAlert('رقم الهاتف يجب أن يكون 10 أرقام على الأقل');
                return;
            }
            
            if (!phone.startsWith('05')) {
                showAlert('رقم الهاتف يجب أن يبدأ بـ 05');
                return;
            }
            
            // إخفاء النموذج وإظهار التحميل
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loadingSection').classList.remove('hidden');
            
            try {
                // التحقق من عدم وجود رقم الهاتف مسبقًا
                const usersRef = db.collection('users');
                const snapshot = await usersRef.where('phone', '==', phone).get();
                
                if (!snapshot.empty) {
                    throw new Error('رقم الهاتف مسجل مسبقاً');
                }
                
                // الانتظار 10 ثواني
                setTimeout(async () => {
                    try {
                        // إنشاء بيانات المستخدم
                        const userData = {
                            name: name,
                            phone: phone,
                            country: country,
                            address: address,
                            avatarColor: getRandomColor(),
                            createdAt: new Date().toISOString(),
                            lastLogin: new Date().toISOString(),
                            accountsCount: 0,
                            isOnline: true
                        };
                        
                        // إضافة المستخدم إلى Firebase
                        const docRef = await usersRef.add(userData);
                        
                        // حفظ بيانات المستخدم
                        currentUser = {
                            id: docRef.id,
                            ...userData
                        };
                        
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        
                        // إظهار شاشة النجاح
                        document.getElementById('loadingSection').classList.add('hidden');
                        document.getElementById('successSection').classList.remove('hidden');
                        
                        // الانتقال للتطبيق بعد 2 ثواني
                        setTimeout(() => {
                            showApp();
                            loadAccounts();
                            showAlert('تم إنشاء حسابك بنجاح!', 'success');
                        }, 2000);
                        
                    } catch (error) {
                        document.getElementById('loadingSection').classList.add('hidden');
                        document.getElementById('registerForm').classList.remove('hidden');
                        showAlert(error.message);
                    }
                }, 10000);
                
            } catch (error) {
                document.getElementById('loadingSection').classList.add('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
                showAlert(error.message);
            }
        });

        // 3. تسجيل الدخول التلقائي
        function autoLogin() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    updateUserStatus(true);
                    showApp();
                    loadAccounts();
                    updateUserInfo();
                } catch (error) {
                    localStorage.removeItem('currentUser');
                }
            }
        }

        // 4. تحديث حالة المستخدم
        async function updateUserStatus(isOnline) {
            if (!currentUser) return;
            
            try {
                await db.collection('users').doc(currentUser.id).update({
                    isOnline: isOnline,
                    lastLogin: new Date().toISOString()
                });
            } catch (error) {
                console.error('Error updating user status:', error);
            }
        }

        // 5. تحديث معلومات المستخدم
        function updateUserInfo() {
            if (!currentUser) return;
            
            document.getElementById('userDisplayName').textContent = currentUser.name;
            document.getElementById('userDisplayPhone').textContent = currentUser.phone;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0);
            document.getElementById('userAvatar').style.background = currentUser.avatarColor;
        }

        // 6. تسجيل الخروج
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            await updateUserStatus(false);
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('app').style.display = 'none';
            document.getElementById('authScreen').style.display = 'flex';
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('loadingSection').classList.add('hidden');
            document.getElementById('successSection').classList.add('hidden');
            showAlert('تم تسجيل الخروج', 'info');
        });

        // 7. عرض التطبيق
        function showApp() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            updateUserInfo();
        }

        // 8. تحميل الحسابات
        async function loadAccounts() {
            const accountsList = document.getElementById('accountsList');
            accountsList.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><div>جاري تحميل الحسابات...</div></div>';
            
            try {
                const snapshot = await db.collection('accounts')
                    .where('status', '==', 'active')
                    .orderBy('createdAt', 'desc')
                    .limit(20)
                    .get();
                
                accountsList.innerHTML = '';
                
                if (snapshot.empty) {
                    accountsList.innerHTML = '<div class="empty-state"><i class="fas fa-store-slash"></i><div>لا توجد حسابات للبيع حالياً</div></div>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const account = doc.data();
                    const accountId = doc.id;
                    createAccountCard(account, accountId);
                });
            } catch (error) {
                console.error('Error loading accounts:', error);
                accountsList.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><div>حدث خطأ في تحميل الحسابات</div></div>';
            }
        }

        // 9. إنشاء بطاقة حساب
        function createAccountCard(account, accountId) {
            const accountsList = document.getElementById('accountsList');
            
            const platformIcons = {
                instagram: { icon: 'fab fa-instagram', class: 'instagram', name: 'إنستغرام' },
                facebook: { icon: 'fab fa-facebook', class: 'facebook', name: 'فيسبوك' },
                tiktok: { icon: 'fab fa-tiktok', class: 'tiktok', name: 'تيك توك' },
                twitter: { icon: 'fab fa-twitter', class: 'twitter', name: 'تويتر' },
                youtube: { icon: 'fab fa-youtube', class: 'youtube', name: 'يوتيوب' },
                snapchat: { icon: 'fab fa-snapchat', class: 'snapchat', name: 'سناب شات' }
            };
            
            const platform = platformIcons[account.platform] || platformIcons.instagram;
            
            const accountCard = document.createElement('div');
            accountCard.className = 'account-card';
            
            // إعداد تاريخ النشر
            const postDate = account.createdAt ? 
                new Date(account.createdAt).toLocaleDateString('ar-SA') : 'غير محدد';
            
            accountCard.innerHTML = `
                <div class="card-header">
                    <div class="platform-badge ${platform.class}">
                        <i class="${platform.icon}"></i>
                    </div>
                    <div class="card-info">
                        <h3>${platform.name}</h3>
                        <p>${account.username}</p>
                    </div>
                </div>
                
                <div class="card-details">
                    <div class="detail-item">
                        <span class="detail-label">المتابعون</span>
                        <span class="detail-value">${account.followers ? account.followers.toLocaleString() : '0'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">البائع</span>
                        <span class="detail-value">${account.sellerName}</span>
                    </div>
                    ${account.description ? `
                    <div class="detail-item">
                        <span class="detail-label">الوصف</span>
                        <span class="detail-value">${account.description}</span>
                    </div>` : ''}
                </div>
                
                <div class="card-price">${account.price ? account.price.toLocaleString() : '0'} ر.س</div>
                
                ${account.proofImages && account.proofImages.length > 0 ? `
                <div class="card-images">
                    <div class="images-header">
                        <i class="fas fa-images"></i>
                        صور إثبات الملكية
                    </div>
                    <div class="images-container">
                        ${account.proofImages.slice(0, 3).map((img, index) => `
                            <div class="image-thumb" onclick="viewImage('${img}')">
                                <img src="${img}" alt="إثبات ${index + 1}" loading="lazy">
                            </div>
                        `).join('')}
                    </div>
                </div>` : ''}
                
                <div class="card-actions">
                    <button class="action-btn primary" onclick="contactSeller('${account.sellerId}')">
                        <i class="fas fa-phone-alt"></i>
                        تواصل مع البائع
                    </button>
                    <button class="action-btn secondary" onclick="startChat('${account.sellerId}', '${account.sellerName}')">
                        <i class="fas fa-comment-dots"></i>
                        دردشة مباشرة
                    </button>
                </div>
                
                <div class="seller-info">
                    <div class="seller-avatar" style="background: ${account.sellerAvatarColor || getRandomColor()}">
                        ${account.sellerName ? account.sellerName.charAt(0) : '?'}
                    </div>
                    <div>
                        <h4>${account.sellerName || 'غير معروف'}</h4>
                        <p style="font-size: 12px; color: #94a3b8;">تم النشر: ${postDate}</p>
                    </div>
                </div>
            `;
            
            accountsList.appendChild(accountCard);
        }

        // 10. عرض صورة
        function viewImage(url) {
            window.open(url, '_blank');
        }

        // 11. التواصل مع البائع
        async function contactSeller(sellerId) {
            if (!currentUser) {
                showAlert('يجب تسجيل الدخول أولاً');
                return;
            }
            
            try {
                const sellerDoc = await db.collection('users').doc(sellerId).get();
                if (!sellerDoc.exists) {
                    showAlert('المستخدم غير موجود');
                    return;
                }
                
                const seller = sellerDoc.data();
                
                const message = `معلومات البائع:
                
الاسم: ${seller.name}
الهاتف: ${seller.phone || 'غير متوفر'}
الدولة: ${seller.country || 'غير محدد'}
العنوان: ${seller.address || 'غير محدد'}`;
                
                alert(message);
                
            } catch (error) {
                showAlert('حدث خطأ في تحميل معلومات البائع');
            }
        }

        // 12. بدء الدردشة
        async function startChat(userId, userName) {
            if (!currentUser) {
                showAlert('يجب تسجيل الدخول أولاً');
                return;
            }
            
            if (userId === currentUser.id) {
                showAlert('لا يمكنك الدردشة مع نفسك');
                return;
            }
            
            currentChatUser = { id: userId, name: userName };
            
            document.getElementById('chatAvatar').textContent = userName.charAt(0);
            document.getElementById('chatUserName').textContent = userName;
            document.getElementById('chatModal').style.display = 'flex';
            
            await loadChatMessages(userId);
            setupChatListener(userId);
        }

        // 13. تحميل الرسائل
        async function loadChatMessages(userId) {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 30px;">جاري تحميل المحادثة...</div>';
            
            try {
                const chatId = getChatId(currentUser.id, userId);
                const snapshot = await db.collection('chats')
                    .doc(chatId)
                    .collection('messages')
                    .orderBy('timestamp', 'asc')
                    .limit(50)
                    .get();
                
                chatMessages.innerHTML = '';
                
                if (snapshot.empty) {
                    chatMessages.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 30px;">ابدأ محادثة جديدة</div>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const message = doc.data();
                    displayMessage(message);
                });
                
                scrollToBottom();
                
            } catch (error) {
                console.error('Error loading messages:', error);
                chatMessages.innerHTML = '<div style="text-align: center; color: #ef4444; padding: 30px;">حدث خطأ في تحميل المحادثة</div>';
            }
        }

        // 14. إنشاء معرف المحادثة
        function getChatId(userId1, userId2) {
            return [userId1, userId2].sort().join('_');
        }

        // 15. عرض الرسالة
        function displayMessage(message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-bubble ${message.senderId === currentUser.id ? 'sent' : 'received'}`;
            messageDiv.textContent = message.text;
            
            // إضافة الوقت
            const timeSpan = document.createElement('span');
            timeSpan.style.cssText = 'display: block; font-size: 11px; opacity: 0.7; margin-top: 5px; text-align: right;';
            timeSpan.textContent = message.timestamp ? 
                new Date(message.timestamp).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }) : 
                'الآن';
            
            messageDiv.appendChild(timeSpan);
            chatMessages.appendChild(messageDiv);
        }

        // 16. التمرير للأسفل
        function scrollToBottom() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // 17. إعداد مستمع الرسائل
        function setupChatListener(userId) {
            // إزالة المستمع القديم
            if (chatListener) {
                chatListener();
            }
            
            const chatId = getChatId(currentUser.id, userId);
            
            chatListener = db.collection('chats')
                .doc(chatId)
                .collection('messages')
                .orderBy('timestamp', 'asc')
                .onSnapshot((snapshot) => {
                    snapshot.docChanges().forEach((change) => {
                        if (change.type === 'added') {
                            const message = change.doc.data();
                            displayMessage(message);
                            scrollToBottom();
                        }
                    });
                }, (error) => {
                    console.error('Chat listener error:', error);
                });
        }

        // 18. إرسال رسالة
        document.getElementById('sendMessageBtn').addEventListener('click', async function() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            
            if (!text || !currentChatUser || !currentUser) {
                return;
            }
            
            if (text.length === 0) {
                showAlert('يرجى كتابة رسالة');
                return;
            }
            
            const chatId = getChatId(currentUser.id, currentChatUser.id);
            
            try {
                // إنشاء بيانات الرسالة
                const messageData = {
                    text: text,
                    senderId: currentUser.id,
                    senderName: currentUser.name,
                    timestamp: new Date().toISOString(),
                    read: false
                };
                
                // إضافة الرسالة
                await db.collection('chats')
                    .doc(chatId)
                    .collection('messages')
                    .add(messageData);
                
                // تحديث المحادثة
                await db.collection('chats').doc(chatId).set({
                    participants: [currentUser.id, currentChatUser.id],
                    lastMessage: text,
                    lastUpdated: new Date().toISOString(),
                    unreadCount: {
                        [currentChatUser.id]: firebase.firestore.FieldValue.increment(1)
                    }
                }, { merge: true });
                
                // مسح حقل الإدخال
                input.value = '';
                input.focus();
                
            } catch (error) {
                console.error('Error sending message:', error);
                showAlert('حدث خطأ في إرسال الرسالة');
            }
        });

        // 19. إرسال بالضغط على Enter
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                document.getElementById('sendMessageBtn').click();
            }
        });

        // 20. إغلاق الدردشة
        document.getElementById('closeChat').addEventListener('click', function() {
            document.getElementById('chatModal').style.display = 'none';
            if (chatListener) {
                chatListener();
                chatListener = null;
            }
            currentChatUser = null;
        });

        // 21. فتح نافذة الإضافة
        document.getElementById('addAccountBtn').addEventListener('click', function(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showAlert('يجب تسجيل الدخول أولاً');
                return;
            }
            
            document.getElementById('addModal').style.display = 'flex';
        });

        // 22. إغلاق نافذة الإضافة
        document.getElementById('closeAddModal').addEventListener('click', function() {
            document.getElementById('addModal').style.display = 'none';
            resetUploadForm();
        });

        // 23. رفع الصور
        document.getElementById('imageUploadArea').addEventListener('click', function() {
            document.getElementById('imageInput').click();
        });

        document.getElementById('imageInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files).slice(0, 3);
            
            files.forEach(file => {
                validateAndUploadImage(file);
            });
        });

        // 24. التحقق من الصورة ورفعها
        async function validateAndUploadImage(file) {
            // التحقق من عدد الصور
            if (uploadedImages.length >= 3) {
                showAlert('يمكنك رفع 3 صور كحد أقصى', 'info');
                return;
            }
            
            // التحقق من نوع الملف
            if (!ALLOWED_TYPES.includes(file.type)) {
                showAlert('نوع الملف غير مدعوم. يرجى رفع صور بصيغة JPG, PNG, أو GIF');
                return;
            }
            
            // التحقق من حجم الملف
            if (file.size > MAX_FILE_SIZE) {
                showAlert('حجم الملف كبير جداً. الحد الأقصى 5MB');
                return;
            }
            
            // رفع الصورة
            await uploadImageToFirebase(file);
        }

        // 25. رفع الصورة إلى Firebase
        async function uploadImageToFirebase(file) {
            try {
                // إنشاء اسم فريد للملف
                const fileName = `${Date.now()}_${file.name.replace(/\s+/g, '_')}`;
                const storageRef = firebase.storage().ref();
                const imageRef = storageRef.child(`account-proofs/${currentUser.id}/${fileName}`);
                
                // رفع الملف
                const uploadTask = imageRef.put(file);
                
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // يمكن إضافة شريط تقدم هنا إذا لزم الأمر
                    },
                    (error) => {
                        console.error('Upload error:', error);
                        showAlert('حدث خطأ في رفع الصورة');
                    },
                    async () => {
                        // الحصول على رابط التحميل
                        const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                        
                        // حفظ الرابط في المصفوفة
                        uploadedImages.push(downloadURL);
                        updateImagePreview();
                        
                        showAlert('تم رفع الصورة بنجاح', 'success');
                    }
                );
                
            } catch (error) {
                console.error('Upload error:', error);
                showAlert('حدث خطأ في رفع الصورة');
            }
        }

        // 26. تحديث معاينة الصور
        function updateImagePreview() {
            const preview = document.getElementById('imagesPreview');
            preview.innerHTML = '';
            
            uploadedImages.forEach((url, index) => {
                const item = document.createElement('div');
                item.className = 'preview-item';
                item.innerHTML = `
                    <img src="${url}" alt="صورة الإثبات" loading="lazy">
                    <div class="remove-btn" onclick="removeImage(${index})">
                        <i class="fas fa-times"></i>
                    </div>
                `;
                preview.appendChild(item);
            });
        }

        // 27. إزالة صورة
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            updateImagePreview();
        }

        // 28. إعادة تعيين النموذج
        function resetUploadForm() {
            document.getElementById('addAccountForm').reset();
            uploadedImages = [];
            updateImagePreview();
        }

        // 29. نشر حساب جديد
        document.getElementById('addAccountForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showAlert('يجب تسجيل الدخول أولاً');
                return;
            }
            
            if (uploadedImages.length < 2) {
                showAlert('يرجى رفع صورتين على الأقل كإثبات للملكية');
                return;
            }
            
            const platform = document.getElementById('accountPlatform').value;
            const username = document.getElementById('accountUsername').value.trim();
            const followers = parseInt(document.getElementById('accountFollowers').value);
            const price = parseInt(document.getElementById('accountPrice').value);
            const description = document.getElementById('accountDescription').value.trim();
            
            if (!platform || !username || !followers || !price) {
                showAlert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }
            
            if (followers < 0 || price < 0) {
                showAlert('القيم يجب أن تكون إيجابية');
                return;
            }
            
            try {
                await db.collection('accounts').add({
                    platform: platform,
                    username: username,
                    followers: followers,
                    price: price,
                    description: description,
                    proofImages: uploadedImages,
                    sellerId: currentUser.id,
                    sellerName: currentUser.name,
                    sellerAvatarColor: currentUser.avatarColor,
                    createdAt: new Date().toISOString(),
                    status: 'active',
                    views: 0
                });
                
                showAlert('تم نشر الحساب بنجاح!', 'success');
                
                document.getElementById('addModal').style.display = 'none';
                resetUploadForm();
                loadAccounts();
                
            } catch (error) {
                console.error('Error adding account:', error);
                showAlert('حدث خطأ في نشر الحساب');
            }
        });

        // 30. عرض المستخدمين
        document.getElementById('viewUsersBtn').addEventListener('click', async function(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showAlert('يجب تسجيل الدخول أولاً');
                return;
            }
            
            document.getElementById('pageTitle').textContent = 'المستخدمين النشطين';
            document.getElementById('accountsList').classList.add('hidden');
            document.getElementById('usersList').classList.remove('hidden');
            
            await loadUsers();
        });

        // 31. تحميل المستخدمين
        async function loadUsers() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><div>جاري تحميل المستخدمين...</div></div>';
            
            try {
                const snapshot = await db.collection('users')
                    .orderBy('lastLogin', 'desc')
                    .limit(50)
                    .get();
                
                usersList.innerHTML = '';
                
                if (snapshot.empty) {
                    usersList.innerHTML = '<div class="empty-state"><i class="fas fa-users-slash"></i><div>لا توجد مستخدمين</div></div>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const user = doc.data();
                    const userId = doc.id;
                    
                    if (userId === currentUser.id) return;
                    
                    createUserCard(user, userId);
                });
                
            } catch (error) {
                console.error('Error loading users:', error);
                usersList.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><div>حدث خطأ في تحميل المستخدمين</div></div>';
            }
        }

        // 32. إنشاء بطاقة مستخدم
        function createUserCard(user, userId) {
            const usersList = document.getElementById('usersList');
            
            const userCard = document.createElement('div');
            userCard.className = 'user-card';
            
            userCard.innerHTML = `
                <div class="user-avatar-large" style="background: ${user.avatarColor || getRandomColor()}">
                    ${user.name.charAt(0)}
                </div>
                <div class="user-details">
                    <h3>${user.name}</h3>
                    <p><i class="fas fa-phone"></i> ${user.phone}</p>
                    <p style="margin-top: 5px;"><i class="fas fa-map-marker-alt"></i> ${user.country || 'غير محدد'}</p>
                    ${user.isOnline ? `<span class="status-badge status-active" style="margin-top: 5px; display: inline-block;"><i class="fas fa-circle" style="font-size: 8px;"></i> متصل الآن</span>` : ''}
                </div>
            `;
            
            userCard.addEventListener('click', () => {
                startChat(userId, user.name);
            });
            
            usersList.appendChild(userCard);
        }

        // 33. عرض الحسابات عند النقر على العلامة
        document.querySelector('.logo-container').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('pageTitle').textContent = 'الحسابات المتاحة للشراء';
            document.getElementById('accountsList').classList.remove('hidden');
            document.getElementById('usersList').classList.add('hidden');
        });

        // 34. عرض الدردشات
        document.getElementById('viewChatsBtn').addEventListener('click', function(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showAlert('يجب تسجيل الدخول أولاً');
                return;
            }
            
            showAlert('قريباً: صفحة الدردشات', 'info');
        });

        // 35. وظائف مساعدة
        function getRandomColor() {
            const colors = [
                'linear-gradient(90deg, #3b82f6, #8b5cf6)',
                'linear-gradient(90deg, #10b981, #34d399)',
                'linear-gradient(90deg, #f59e0b, #f97316)',
                'linear-gradient(90deg, #8b5cf6, #ec4899)',
                'linear-gradient(90deg, #06b6d4, #0ea5e9)'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // 36. إغلاق النوافذ بالنقر خارجها
        window.addEventListener('click', function(e) {
            if (e.target.id === 'addModal') {
                document.getElementById('addModal').style.display = 'none';
                resetUploadForm();
            }
        });

        // 37. جعل الدوال متاحة عالمياً
        window.viewImage = viewImage;
        window.contactSeller = contactSeller;
        window.startChat = startChat;
        window.removeImage = removeImage;

        // 38. تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            autoLogin();
        });
    </script>
</body>
</html>
